---
title: 用户模块
date: 2018-05-30 18:14:00
tags:
---
# 用户模块
## 登录方式
本站使用QQ登录，授权后调用(畅言)[http://changyan.kuaizhan.com]

<!-- more -->
## 模块使用
> `application/config.php` 注册根命名空间
```php
'root_namespace'         => [
            'extend\login' => '../extend/login/',
            ],
```
> 将login文件夹放置extend位置

> 全部类继承`BaseController`,
```php
class IndexController extends BaseController
```
> 全部涉及用户操作的方法外部增加判断用户登录态
```php
if($this->isLogin())
{
	#内容
}
```

## 数据库字段定义
> 用户表：
	user_login:json,NOT NULL,   ->表示用户登录信息
	openid：varchar(32),NOT NULL, ->表示用户唯一标识，与QQ登录态标识一致

## 用户登录态
> 使用SESSION，BaseController已引入，每次登录后会注册两条key-value

	Session::set('openid',$user['openid']); 
    Session::set('nickname',$user['nickname']);

# 评论模块,分两种形式
## 一般评论
> 在生成文章html文件时，后追加评论区代码
```php
<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="此处修改为用于标识文章唯一性的变量：ID或日期" ></div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cysndEbEw'; 
var conf = 'prod_ddef60885a4c275a24ddeda9094becd5'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) { 
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

```
## 短评
> 在生成文章html文件时，后追加评论区代码
```php
<!-- 代码1：放在页面需要展示的位置  -->
<!-- 如果您配置过sourceid，建议在div标签中配置sourceid、cid(分类id)，没有请忽略  -->
<div id="cyQing" role="cylabs" data-use="qing" sid="此处修改为用于标识文章唯一性的变量：ID或日期"></div>
<!-- 代码2：用来读取评论框配置，此代码需放置在代码1之后。 -->
<!-- 如果当前页面有评论框，代码2请勿放置在评论框代码之前。 -->
<!-- 如果页面同时使用多个实验室项目，以下代码只需要引入一次，只配置上面的div标签即可 -->
<script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysndEbEw"></script>
```

# 投票模块
> 在生成需要关联投票的文章时，追加此投票代码
```
<!-- 代码1：放在页面需要展示的位置  -->
<!-- 如果您配置过sourceid，建议在div标签中配置sourceid、cid(分类id)，没有请忽略  -->
<div id="cyPoll" role="cylabs" data-use="poll"></div>
<!-- 代码2：用来读取评论框配置，此代码需放置在代码1之后。 -->
<!-- 如果当前页面有评论框，代码2请勿放置在评论框代码之前。 -->
<!-- 如果页面同时使用多个实验室项目，以下代码只需要引入一次，只配置上面的div标签即可 -->
<script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysndEbEw"></script>
```

*本文仅作为过程性记录，不具有一般适用性，本文采用https://makergyt.com/md 构建*

