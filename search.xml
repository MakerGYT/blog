<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>排版规约</title>
    <url>/typesetting/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="1-一级标题">1 一级标题</h2><p>章标题居中，三号黑体，为了避免标题与正文差异较大，统一顺延，这里使用<code>##</code>。后续标题应循序渐进，不能直接出现三级标题。</p><h3 id="1-1-二级标题">1.1 二级标题</h3><p>章下为节，节标题四号黑体，使用<code>###</code>。</p><h4 id="1-1-1-三级标题">1.1.1 三级标题</h4><p>节下为小节，小节标题小四黑体，使用<code>####</code>。</p><h5 id="1-1-1-1-四级标题">1.1.1.1 四级标题</h5><h6 id="1-1-1-1-1-五级标题">1.1.1.1.1 五级标题</h6><p>一般只使用一二三级标题，不自动生成而应自行按序标号。</p><h2 id="2-列表">2 列表</h2><h3 id="2-1-无序列表">2.1 无序列表</h3><p>无序列表在符号<code>-</code>后加空格使用：</p><ul><li>无序列表 1</li><li>无序列表 2</li><li>无序列表 3</li></ul><p>如果要控制列表的层级，则需要在符号<code>-</code>前使用空格：</p><ul><li>无序列表 1</li><li>无序列表 2<ul><li>无序列表 2.1</li><li>无序列表 2.2</li></ul></li></ul><p>适用于对条文内容采用分行并叙, 或结构有层级关系。<strong>列举结束必须换行</strong>。</p><h3 id="2-2-有序列表">2.2 有序列表</h3><p>有序列表的使用，在数字及符号<code>.</code>后加空格后输入内容，如下：</p><ol><li>有序列表 1</li><li>有序列表 2</li><li>有序列表 3</li></ol><p>适用于表达同步顺序关系。</p><h3 id="2-3-分段并叙">2.3 分段并叙</h3><p>故当文章结构复杂，小节以下的标题使用以下方式:</p><p><strong>（1）</strong> 如果列表其后内容新起一个段落，则需要换行,由于对列表分段换行后会失序，且统一缩进会导致需要通屏展示的内容（如代码块）产生挤压。</p><p><strong>（2）</strong> 加粗手动标号，依次用<code>**（1）**</code>、<code>**（2）**</code>……，或者<code>**1)**</code>、<code>**a)**</code></p><p><strong>（3）</strong> 标号(标题)与段落内容之间要加空格</p><h2 id="3-引用">3 引用</h2><p>引用的格式是在符号<code>&gt;</code>后面书写文字。如下：</p><blockquote><p>疫情就是命令，防控就是责任。 ——领袖</p></blockquote><p>用于大段原文引用，<strong>引用结束必须换行</strong>。</p><h2 id="4-文本">4 文本</h2><h3 id="4-1-粗体和斜体">4.1 粗体和斜体</h3><p><strong>用粗体标识段落内强调项</strong>，<em>一般只在英文中使用斜体</em>，<em><strong>用粗体加斜体标识注意项</strong></em>。<br>如果信息之间关联性越高，它们之间的距离就应该越接近，也越像一个视觉单元；反之，则它们的距离就应该越远，也越像多个视觉单元。亲密性的根本目的是实现组织性，让用户对页面结构和信息层次一目了然。</p><p>正如「格式塔学派」中的连续律（Law of Continuity）所描述的，在知觉过程中人们往往倾向于使知觉对象的直线继续成为直线，使曲线继续成为曲线。在界面设计中，将元素进行对齐，既符合用户的认知特性，也能引导视觉流向，让用户更流畅地接收信息<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。</p><h3 id="4-2-分割线">4.2 分割线</h3><p>可以在一行中用三个以上的减号来建立一个分隔线，同时需要在分隔线的上面空一行。如下：</p><hr><h3 id="4-3-删除线">4.3 删除线</h3><p>删除线的使用，在需要删除的文字前后各使用两个<code>~</code>，如下：</p><p><s>新冠肺炎</s></p><h2 id="5-插入">5 插入</h2><h3 id="5-1-链接">5.1 链接</h3><p>一个在hexo博客中插入豆瓣读书的<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21ha2VyZ3l0L2hleG8tdGFnLWJvb2stZG91YmFu" title="https://github.com/makergyt/hexo-tag-book-douban">npm包<i class="fa fa-external-link"></i></span>。</p><h3 id="5-2-脚注">5.2 脚注</h3><p>要在标点符号之前使用<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，用于备注，或综合原文得到的结论。<strong>注解会自动生成在最后，但仍应统一写在最后</strong>。要注意序号与文中位置先后一致。</p><h2 id="6-表格">6 表格</h2><p>可以使用冒号来定义表格的对齐方式，如下：</p><table><thead><tr><th style="text-align:center">居中</th><th style="text-align:left">左对齐</th><th style="text-align:right">右对齐</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">山西</td><td style="text-align:left">133</td><td style="text-align:right">133</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">湖北</td><td style="text-align:left">67790</td><td style="text-align:right">52960</td><td style="text-align:center">2895</td></tr><tr><td style="text-align:center">意大利</td><td style="text-align:left">17660</td><td style="text-align:right">1439</td><td style="text-align:center">80539</td></tr></tbody></table><h2 id="7-代码块">7 代码块</h2><p>如果在一个行内需要引用代码，只要用反引号引起来就好，如下：</p><p>Use the <code>printf()</code> function.</p><p>在需要高亮的代码块的前一行及后一行使用三个反引号，同时<strong>第一行反引号后面表示代码块所使用的语言</strong>，如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//要写清文件位置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 行间注释</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello,World!"</span>); <span class="comment">// 行内注释</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>diff:</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+ 新增项</span></span><br><span class="line"><span class="deletion">- 删除项</span></span><br></pre></td></tr></table></figure><p>html:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"display:block;text-align:left;color:rgb(255, 0, 54);"</span>&gt;</span>天猫红居左<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"display:block;text-align:right;color:#ff6a00;"</span>&gt;</span>阿里橙居右<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"display:block;text-align:center;color:#019fe8;"</span>&gt;</span>支付宝蓝居中<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="8-数学公式">8 数学公式</h2><h3 id="8-1-可用">8.1 可用</h3><h4 id="8-1-1-公式">8.1.1 公式:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bequation%7D%0A%20%20e%3Dmc%5E2%0A%20%20%5Cend%7Bequation%7D%0A"></p><h4 id="8-1-2-分式">8.1.2 分式:</h4><p><img data-src="https://math.now.sh?inline=%5Cfrac%20%7Ba%2B1%7D%7Bb%2B2%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> 和 <img data-src="https://math.now.sh?inline=x%3D%7Ba%2B1%20%5Cover%20b%2B1%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%7B%0A%20%20x%2B1%5Cover%5Csqrt%7B1-x%5E2%7D%20%0A%7D%20%20%5Cqquad%281%29%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%7B%0Ae%5Ex%3D%5Clim_%7Bn%5Cto%5Cinfty%7D%20%5Cleft%28%201%2B%5Cfrac%7Bx%7D%7Bn%7D%20%5Cright%29%5En%0A%5Cqquad%20(2)%20%0A%7D%0A"></p><h4 id="8-1-3-化学公式：">8.1.3 化学公式：</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cce%7BHg%5E2%2B%20-%3E%5BI-%5D%20HgI2%20-%3E%5BI-%5D%20%5BHg%5E%7BII%7DI4%5D%5E2-%7D%0A"></p><h4 id="8-1-4-块公式：">8.1.4 块公式：</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20H%28D_2%29%20%3D%20-%5Cleft(%5Cfrac%7B2%7D%7B4%7D%5Clog_2%20%5Cfrac%7B2%7D%7B4%7D%20%2B%20%5Cfrac%7B2%7D%7B4%7D%5Clog_2%20%5Cfrac%7B2%7D%7B4%7D%5Cright)%20%3D%201%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Csum_%7Bi%3D0%7D%5En%20%3D%20%5Cfrac%7B%28n%5E2%2Bn%29(2n%2B1)%7D%7B6%7D%0A"></p><h4 id="8-1-5-内联公式">8.1.5 内联公式</h4><p><img data-src="https://math.now.sh?inline=%5Csum_%7Bi%3D0%7D%5En" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> 和 <img data-src="https://math.now.sh?inline=%5Cfrac%7B1%7D%7B2%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p><strong>开头的<code>$</code>必须在其右边紧跟一个非空格字符，而结尾的<code>$</code>必须在其左边紧接一个非空格字符，并且不能紧跟一个数字。</strong></p><h4 id="8-1-6-希腊字母">8.1.6 希腊字母</h4><p>对于希腊字母，用 <img data-src="https://math.now.sh?inline=%5Calpha%20%5Cbeta%2C...%2C%5Comega" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">来表示。</p><p><img data-src="https://math.now.sh?inline=%5Cphi%20%5Cvarphi" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> 和 <img data-src="https://math.now.sh?inline=%5Cell" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><h4 id="8-1-7-上下标">8.1.7 上下标</h4><p>分别使用 ^ 和 _ 实现，比如：<img data-src="https://math.now.sh?inline=x_i%5E%7B10%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ; <img data-src="https://math.now.sh?inline=%7Bx%5Ey%7D%5Ez" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ; <img data-src="https://math.now.sh?inline=x_%7Bi%5E%7B10%7D%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><p>开根号<img data-src="https://math.now.sh?inline=%5Csqrt%5B4%5D%20%7Bx_3%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p>字母顶部</p><ul><li><img data-src="https://math.now.sh?inline=%5Chat%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Cwidehat%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cbar%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Coverline%20%7Bxyz%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Coverrightarrow%20%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Coverleftrightarrow%20%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cdot%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li></ul><h4 id="8-1-8-括号">8.1.8 括号</h4><p>圆括号和方括号 <img data-src="https://math.now.sh?inline=%282%2B2%29%5B4-4%5D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br>花括号需要用{和}表示，比如<img data-src="https://math.now.sh?inline=%5C%7Bx%7C%20x%3E0%5C%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br>遇到高度较高的分数，括号会变小，如 <img data-src="https://math.now.sh?inline=%28%5Cfrac%7B%5Csqrt%20x%7D%7By%5E3%7D%29" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，可以使用<code>\left(…\right)</code>可以自动调整括号的行高，比如 <img data-src="https://math.now.sh?inline=%5Cleft%28%5Cfrac%7B%5Csqrt%20x%7D%7By%5E3%7D%5Cright%29" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><h4 id="8-1-9-求和、极限与积分">8.1.9 求和、极限与积分</h4><p><img data-src="https://math.now.sh?inline=%5Csum_1%5En" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Cint" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">= ，<img data-src="https://math.now.sh?inline=%5Cprod" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br><img data-src="https://math.now.sh?inline=%5Cbigcup" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Cbigcap" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Ciint" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Clim_%7Bk%5Cto%5Cinfty%7Dk%5E%7B-1%7D%20%3D%200%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Csum_%7Bk%3D1%7D%5E%7Bn%7Df%28k%29%0A"></p><h4 id="8-1-10-特殊函数">8.1.10 特殊函数</h4><p>初等函数<br><img data-src="https://math.now.sh?inline=%5Clog_a%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， <img data-src="https://math.now.sh?inline=%5Cln%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， <img data-src="https://math.now.sh?inline=%5Csin%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> ，<img data-src="https://math.now.sh?inline=%5Cmax%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><h4 id="8-1-11-特殊符号">8.1.11 特殊符号</h4><ul><li><img data-src="https://math.now.sh?inline=%5Clt%20%5Cgt%20%5Cle%20%5Cge%20%5Cneq" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Ctimes%20%5Cdiv%20%5Cpm%20%5Cmp" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Ccup%20%5Ccap%20%5Csetminus%20%5Csubset%20%5Csubseteq%20%5Csubsetneq%20%5Csupset%20%5Cin%20%5Cnotin%20%5Cemptyset%20%5Cvarnothing" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%7Bn%2B1%20%5Cchoose%202k%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> or <img data-src="https://math.now.sh?inline=%5Cbinom%7Bn%2B1%7D%7B2k%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cto%20%5Crightarrow%20%5Cleftarrow%20%5CRightarrow%20%5CLeftarrow%20%5Cmapsto" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cland%20%5Clor%20%5Clnot%20%5Cforall%20%5Cexists%20%5Ctop%20%5Cbot%20%5Cvdash%20%5CvDash" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Capprox%20%5Csim%20%5Csimeq%20%5Ccong%20%5Cequiv%20%5Cprec" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a%5Cequiv%20b%5Cpmod%20n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a_1%2Ca_2%2C%5Cldots%2Ca_n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a_1%2Ba_2%2B%5Ccdots%2Ba_n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cinfty%20%5Caleph_0" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">，<img data-src="https://math.now.sh?inline=%5Cnabla%20%5Cpartial" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">，<img data-src="https://math.now.sh?inline=%5CIm%20%5CRe%20IR" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li></ul><h4 id="8-1-12-纯文本">8.1.12 纯文本</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5C%5C%7Bx%5Cin%20s%20%7C%20%5Ctext%7Bx%20is%20extra%20large%7D%5C%5C%7D%0A"></p><p>单空格<img data-src="https://math.now.sh?inline=a%20%5C%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， 多空格<img data-src="https://math.now.sh?inline=a%20%5Cquad%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">。</p><h3 id="8-2-可能有误">8.2 可能有误</h3><h4 id="8-2-1-等式断行">8.2.1 等式断行:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bequation%7D%20%5Clabel%7Beq2%7D%0A%20%20%5Cbegin%7Baligned%7D%0A%20%20a%20%26%3D%20b%20%2B%20c%20%20%5C%5C%0A%20%20%20%20%26%3D%20d%20%2B%20e%20%2B%20f%20%2B%20g%20%5C%5C%0A%20%20%20%20%26%3D%20h%20%2B%20i%20%5C%5C%0A%20%20%5Cend%7Baligned%7D%0A%20%20%5Cend%7Bequation%7D%0A"></p><h4 id="8-2-2-方程断行编号">8.2.2 方程断行编号:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Balign%7D%0A%20%20a%20%26%3D%20b%20%2B%20c%20%5Clabel%7Beq3%7D%20%5C%5C%0A%20%20x%20%26%3D%20yz%20%5C%5C%0A%20%20l%20%26%3D%20m%20-%20n%20%5C%5C%0A%20%20%5Cend%7Balign%7D%0A"></p><h4 id="8-2-3-多列式断行编号">8.2.3 多列式断行编号:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Balign%7D%0A%20%20-4%20%2B%205x%20%26%3D%202%2By%20%5C%5C%0A%20%20w%2B2%20%26%3D%20-1%2Bw%20%5C%5C%0A%20%20ab%20%26%3D%20cb%20%5C%5C%0A%20%20%5Cend%7Balign%7D%20%0A"></p><h4 id="8-2-4-矩阵断行：">8.2.4 矩阵断行：</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bpmatrix%7D%0A%20%201%20%26%20a_1%20%26%20a_1%5E2%20%26%20%5Ccdots%20%26%20a_1%5En%20%5C%5C%0A%20%201%20%26%20a_2%20%26%20a_2%5E2%20%26%20%5Ccdots%20%26%20a_2%5En%20%5C%5C%0A%20%20%5Cvdots%20%26%20%5Cvdots%20%26%20%5Cvdots%20%26%20%5Cddots%20%26%20%5Cvdots%20%5C%5C%0A%20%201%20%26%20a_m%20%26%20a_m%5E2%20%26%20%5Ccdots%20%26%20a_m%5En%20%5C%5C%0A%20%20%5Cend%7Bpmatrix%7D%0A"></p><h4 id="8-2-5-分支等式换行">8.2.5 分支等式换行</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=f%28n%29%3D%0A%5Cbegin%7Bcases%7D%0An%2F2%2C%26%20%5Ctext%7Bif%20%24n%24%20is%20even%7D%5C%5C%0A3n%2B1%2C%26%20%5Ctext%7Bif%20%24n%24%20is%20odd%7D%0A%5Cend%7Bcases%7D%0A"></p><h4 id="8-2-6-表格式数组">8.2.6 表格式数组</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Cbegin%7Barray%7D%7Bc%7Clcr%7D%0An%20%26%20%5Ctext%7BLeft%7D%20%26%20%5Ctext%7BCenter%7D%20%26%20%5Ctext%7BRight%7D%20%5C%5C%0A%5Chline%0A1%20%26%200.24%20%26%201%20%26%20125%20%5C%5C%0A2%20%26%20-1%20%26%20189%20%26%20-8%20%5C%5C%0A3%20%26%20-20%20%26%202000%20%26%201%2B10i%0A%5Cend%7Barray%7D%0A"></p><h2 id="9-媒体">9 媒体</h2><h3 id="9-1-图片">9.1 图片</h3><p><img data-src="https://1.s91i.faiusr.com/4/AFsIABAEGAAgztrP8QUohNjw0AYwhAc4-wI!800x800.png?v=1580461392155" alt="图9-1 这里写图片描述"></p><p>支持 jpg、png、gif、svg 等图片格式，svg 文件示例如下：</p><p><img data-src="https://my-wechat.mdnice.com/mdnice/i_am_svg_20191024083453.svg" alt="图9-2 i_am_svg_20191024083453"></p><p>使用外部图片时，必须在图片下方或文末标明来源<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。</p><h2 id="10-特殊">10 特殊</h2><p><strong>一般不使用，除非万不得已</strong></p><h3 id="10-1-解析HTML">10.1 解析HTML</h3><p><span style="display:block;text-align:left;color:#ff0036">天猫红居左</span><br><span style="display:block;text-align:right;color:#ff6a00">阿里橙居右</span><br><span style="display:block;text-align:center;color:#019fe8">支付宝蓝居中</span></p><h2 id="11-规范检查">11 规范检查</h2><p>在文章内容定稿后，同前端开发中的<code>eslint</code>，应该进行编写规范检查，Markdown 常用代码规范检查工具如下<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>：</p><table><thead><tr><th style="text-align:center">工具</th><th style="text-align:center">用途</th><th style="text-align:center">lint命令</th><th style="text-align:center">支持IDE</th></tr></thead><tbody><tr><td style="text-align:center">remark</td><td style="text-align:center">Markdown 通用规范</td><td style="text-align:center">remark -f docs/</td><td style="text-align:center">VSCode</td></tr><tr><td style="text-align:center">lint-md</td><td style="text-align:center">Markdown 中文规范</td><td style="text-align:center">lint-md docs/</td><td style="text-align:center">VSCode</td></tr></tbody></table><p>一般以中文为主，故使用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpbnQtbWQvbGludC1tZA==" title="https://github.com/lint-md/lint-md">lint-md<i class="fa fa-external-link"></i></span>，其中涵盖了中英文混写的规范。但注意其检查结果仅做参考，应以实际效果为先。</p><hr class="footnotes-sep"><h2 id="-参考文献" class="footnotes-meta zh-CN">参 考 文 献</h2><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Ant design.设计模式[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9hbnQuZGVzaWduL2RvY3Mvc3BlYy9pbnRyb2R1Y2UtY24=" title="https://ant.design/docs/spec/introduce-cn">https://ant.design/docs/spec/introduce-cn<i class="fa fa-external-link"></i></span> .2020 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Github.Mastering Markdown[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9ndWlkZXMuZ2l0aHViLmNvbS9mZWF0dXJlcy9tYXN0ZXJpbmctbWFya2Rvd24v" title="https://guides.github.com/features/mastering-markdown/">https://guides.github.com/features/mastering-markdown/<i class="fa fa-external-link"></i></span> .2014 <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>阮一峰.中文技术文档规范[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3J1YW55Zi9kb2N1bWVudC1zdHlsZS1ndWlkZQ==" title="https://github.com/ruanyf/document-style-guide">https://github.com/ruanyf/document-style-guide<i class="fa fa-external-link"></i></span>. 2019 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>Coding.Markdown 代码规范[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9oZWxwLmNvZGluZy5uZXQvZG9jcy9kZXZvcHMvY2kvbGludC9tYXJrZG93bi5odG1s" title="https://help.coding.net/docs/devops/ci/lint/markdown.html">https://help.coding.net/docs/devops/ci/lint/markdown.html<i class="fa fa-external-link"></i></span>. 2020 <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      <categories>
        <category>test</category>
      </categories>
      <tags>
        <tag>测试</tag>
        <tag>排版</tag>
        <tag>标记</tag>
      </tags>
  </entry>
  <entry>
    <title>Typography convention</title>
    <url>/typography_en/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="1-h1">1 h1</h2><p>Chapter title centered,number three in bold,used <code>##</code>.</p><h3 id="1-1-h2">1.1 h2</h3><p>The chapter is a section, and the section title is in bold type,used <code>###</code>.</p><h4 id="1-1-1-h3">1.1.1 h3</h4><p>The section is under the section, and the section title is a small quad,used <code>####</code>.</p><h5 id="1-1-1-1-h4">1.1.1.1 h4</h5><h6 id="1-1-1-1-1-h5">1.1.1.1.1 h5</h6><p>Usually only use headlines one, two and three.</p><h2 id="2-List">2 List</h2><h3 id="2-1-Unordered-list">2.1 Unordered list</h3><p>For the use of unordered lists, use spaces after the symbols<code>-</code>. As follows:</p><ul><li>Unordered list 1</li><li>Unordered list 2</li><li>Unordered list 3</li></ul><p>If you want to control the level of the list, you need to use spaces before the symbols<code>-</code>. As follows:</p><ul><li>Unordered list 1</li><li>Unordered list 2<ul><li>Unordered list 2.1</li><li>Unordered list 2.2</li></ul></li></ul><p>Use branches and narratives for the content of the article, or the structure has a hierarchical relationship.<br>Line must end at the end of the enumeration.</p><h3 id="2-2-Ordered-list">2.2 Ordered list</h3><p>For the use of an ordered list, enter the contents after adding spaces after the numbers and symbols, as follows:</p><ol><li>Ordered list 1</li><li>Ordered list 2</li><li>Ordered list 3</li></ol><p>The following headings in the section, or express a synchronous order relationship.<br><strong>If a new paragraph begins with the number and its content, a new line is required, and the end of the enumeration must be a new line.</strong></p><h2 id="3-Quote">3 Quote</h2><p>The format of the reference is to write after the symbol. As follows:</p><blockquote><p>Epidemic is order, prevention and control is responsibility. ——leader</p></blockquote><p>Used for large text quotes,<strong>End of quote must wrap</strong></p><h2 id="4-Font">4 Font</h2><h3 id="4-1-Bold-and-italics">4.1 Bold and italics</h3><p><strong>This is bold</strong>,<em>Italics are generally only used in English</em>,<em><strong>This is bold &amp; italics</strong></em>.</p><p>If the correlation between information is higher, the distance between them should be closer and more like a visual unit; otherwise, the distance between them should be farther and more like multiple visual units. The basic purpose of intimacy is to achieve organization, so that users can see the page structure and information hierarchy at a glance.</p><p>As described by the Law of Continuity in the Gestalt School, in the process of perception, people tend to make the straight line of the subject of perception continue to be a straight line, and the curve continues to be a curve. In the interface design, the elements are aligned, which not only conforms to the user’s cognitive characteristics, but also guides the visual flow, allowing the user to receive information more smoothly<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p><h3 id="4-2-Dividing-line">4.2 Dividing line</h3><p>You can use more than three minus signs in a row to create a separator line. At the same time, you need to empty a row above the separator line. As follows:</p><hr><h3 id="4-3-Delete-line">4.3 Delete line</h3><p>Use two <code>~</code> before and after the text to be deleted, as follows:</p><p><s>2019-nCoV</s></p><h2 id="5-Insert">5 Insert</h2><h3 id="5-1-Link">5.1 Link</h3><p>A tag to display the information of Douban books in hexo post/page.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21ha2VyZ3l0L2hleG8tdGFnLWJvb2stZG91YmFu" title="https://github.com/makergyt/hexo-tag-book-douban">npm<i class="fa fa-external-link"></i></span></p><h3 id="5-2-Footnote">5.2 Footnote</h3><p>To use before punctuation<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>,used for remarks or conclusions from the original text.<strong>Annotations are automatically generated at the end, but should also be written at the end</strong>.</p><h2 id="6-Table">6 Table</h2><p>You can use colons to define the alignment of tables as follows:</p><table><thead><tr><th style="text-align:center">Center</th><th style="text-align:left">Left</th><th style="text-align:right">Right</th><th style="text-align:center">Remarks</th></tr></thead><tbody><tr><td style="text-align:center">Shanxi</td><td style="text-align:left">133</td><td style="text-align:right">133</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">Hubei</td><td style="text-align:left">67790</td><td style="text-align:right">52960</td><td style="text-align:center">2895</td></tr><tr><td style="text-align:center">Italy</td><td style="text-align:left">17660</td><td style="text-align:right">1439</td><td style="text-align:center">80539</td></tr></tbody></table><h2 id="7-Code">7 Code</h2><h3 id="7-1-Inline">7.1 Inline</h3><p>If you need to refer to code in a line, just use backquotes to cause it, as follows:</p><p>Use the <code>printf()</code> function.</p><h3 id="7-2-Block">7.2 Block</h3><p>Use three quotes before and after the block you want to highlight, and<strong>The first line, followed by the back quotes, indicates the language of the code block</strong>，as follows：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//To write file location information</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Hello,World!"</span>); <span class="comment">// comment</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>diff:</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+ New item</span></span><br><span class="line"><span class="deletion">- Delete item</span></span><br></pre></td></tr></table></figure><h2 id="8-Latex">8 Latex</h2><h3 id="8-1-Available">8.1 Available</h3><h4 id="8-1-1-Equation">8.1.1 Equation</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bequation%7D%0A%20%20e%3Dmc%5E2%0A%20%20%5Cend%7Bequation%7D%0A"></p><h4 id="8-1-2-Fraction">8.1.2 Fraction</h4><p><img data-src="https://math.now.sh?inline=%5Cfrac%20%7Ba%2B1%7D%7Bb%2B2%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> 和 <img data-src="https://math.now.sh?inline=x%3D%7Ba%2B1%20%5C%5Cover%20b%2B1%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%7B%0A%20%20x%2B1%5Cover%5Csqrt%7B1-x%5E2%7D%20%0A%7D%20%20%5Cqquad%281%29%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%7B%0Ae%5Ex%3D%5Clim_%7Bn%5Cto%5Cinfty%7D%20%5Cleft%28%201%2B%5Cfrac%7Bx%7D%7Bn%7D%20%5Cright%29%5En%0A%5Cqquad%20(2)%20%0A%7D%0A"></p><h4 id="8-1-3-Chemical-formula">8.1.3 Chemical formula</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cce%7BHg%5E2%2B%20-%3E%5BI-%5D%20HgI2%20-%3E%5BI-%5D%20%5BHg%5E%7BII%7DI4%5D%5E2-%7D%0A"></p><h4 id="8-1-4-Block-formula">8.1.4 Block formula</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20H%28D_2%29%20%3D%20-%5Cleft(%5Cfrac%7B2%7D%7B4%7D%5Clog_2%20%5Cfrac%7B2%7D%7B4%7D%20%2B%20%5Cfrac%7B2%7D%7B4%7D%5Clog_2%20%5Cfrac%7B2%7D%7B4%7D%5Cright)%20%3D%201%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Csum_%7Bi%3D0%7D%5En%20%3D%20%5Cfrac%7B%28n%5E2%2Bn%29(2n%2B1)%7D%7B6%7D%0A"></p><h4 id="8-1-5-Inline-formula">8.1.5 Inline formula</h4><p><img data-src="https://math.now.sh?inline=%5Csum_%7Bi%3D0%7D%5En" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> 和 <img data-src="https://math.now.sh?inline=%5Cfrac%7B1%7D%7B2%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p><strong>The opening $ must have a non-space character immediately to its right, while the closing $ must have a non-space character immediately to its left, and must not be followed immediately by a digit.</strong></p><h4 id="8-1-6-Greek-alphabet">8.1.6 Greek alphabet</h4><p>For Greek letters，$ \alpha \beta,…,\omega $。</p><p><img data-src="https://math.now.sh?inline=%5Cphi%20%5Cvarphi" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> and <img data-src="https://math.now.sh?inline=%5Cell" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><h4 id="8-1-7-Sub-and-sup">8.1.7 Sub and sup</h4><p>Separate use <code>^</code> and <code>_</code> ，for example：<img data-src="https://math.now.sh?inline=x_i%5E%7B10%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ; <img data-src="https://math.now.sh?inline=%7Bx%5Ey%7D%5Ez" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ; <img data-src="https://math.now.sh?inline=x_%7Bi%5E%7B10%7D%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><p>Root number<img data-src="https://math.now.sh?inline=%5Csqrt%5B4%5D%20%7Bx_3%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><p>Letter top</p><ul><li><img data-src="https://math.now.sh?inline=%5Chat%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Cwidehat%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cbar%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Coverline%20%7Bxyz%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Coverrightarrow%20%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">, <img data-src="https://math.now.sh?inline=%5Coverleftrightarrow%20%7Bxy%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cdot%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li></ul><h4 id="8-1-8-Brackets">8.1.8 Brackets</h4><p>Parentheses and square brackets <img data-src="https://math.now.sh?inline=%282%2B2%29%5B4-4%5D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br>Curly braces need to be represented by \ {and }，such as<img data-src="https://math.now.sh?inline=%5C%7Bx%7C%20x%3E0%5C%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br>When encountering higher scores, the brackets will become smaller, such as <img data-src="https://math.now.sh?inline=%28%5Cfrac%7B%5Csqrt%20x%7D%7By%5E3%7D%29" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<code>\left(…\right)</code>Can automatically adjust the line height of parentheses, such as <img data-src="https://math.now.sh?inline=%5Cleft%28%5Cfrac%7B%5Csqrt%20x%7D%7By%5E3%7D%5Cright%29" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><h4 id="8-1-9-Sum-Limit-and-Integral">8.1.9 Sum, Limit, and Integral</h4><p><img data-src="https://math.now.sh?inline=%5Csum_1%5En" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Cint" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">= ，<img data-src="https://math.now.sh?inline=%5Cprod" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =<br><img data-src="https://math.now.sh?inline=%5Cbigcup" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Cbigcap" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> = ，<img data-src="https://math.now.sh?inline=%5Ciint" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> =</p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Clim_%7Bk%5Cto%5Cinfty%7Dk%5E%7B-1%7D%20%3D%200%0A"></p><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Csum_%7Bk%3D1%7D%5E%7Bn%7Df%28k%29%0A"></p><h4 id="8-1-10-Function">8.1.10 Function</h4><p>Elementary function<br><img data-src="https://math.now.sh?inline=%5Clog_a%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， <img data-src="https://math.now.sh?inline=%5Cln%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， <img data-src="https://math.now.sh?inline=%5Csin%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> ，<img data-src="https://math.now.sh?inline=%5Cmax%20x" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><h4 id="8-1-11-特殊符号">8.1.11 特殊符号</h4><ul><li><img data-src="https://math.now.sh?inline=%5Clt%20%5Cgt%20%5Cle%20%5Cge%20%5Cneq" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Ctimes%20%5Cdiv%20%5Cpm%20%5Cmp" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Ccup%20%5Ccap%20%5Csetminus%20%5Csubset%20%5Csubseteq%20%5Csubsetneq%20%5Csupset%20%5Cin%20%5Cnotin%20%5Cemptyset%20%5Cvarnothing" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%7Bn%2B1%20%5Cchoose%202k%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"> or <img data-src="https://math.now.sh?inline=%5Cbinom%7Bn%2B1%7D%7B2k%7D" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cto%20%5Crightarrow%20%5Cleftarrow%20%5CRightarrow%20%5CLeftarrow%20%5Cmapsto" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cland%20%5Clor%20%5Clnot%20%5Cforall%20%5Cexists%20%5Ctop%20%5Cbot%20%5Cvdash%20%5CvDash" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Capprox%20%5Csim%20%5Csimeq%20%5Ccong%20%5Cequiv%20%5Cprec" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a%5Cequiv%20b%5Cpmod%20n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a_1%2Ca_2%2C%5Cldots%2Ca_n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=a_1%2Ba_2%2B%5Ccdots%2Ba_n" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li><li><img data-src="https://math.now.sh?inline=%5Cinfty%20%5Caleph_0" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">，<img data-src="https://math.now.sh?inline=%5Cnabla%20%5Cpartial" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">，<img data-src="https://math.now.sh?inline=%5CIm%20%5CRe%20IR" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></li></ul><h4 id="8-1-12-Plain-Text">8.1.12 Plain Text</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5C%7Bx%5Cin%20s%20%7C%20%5Ctext%7Bx%20is%20extra%20large%7D%5C%7D%0A"></p><p>Single space<img data-src="https://math.now.sh?inline=a%20%5C%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0">， double space<img data-src="https://math.now.sh?inline=a%20%5Cquad%20b" style="filter:opacity(90%);transform:scale(.85);display:inline-block;margin:0"></p><h3 id="8-2-May-be-wrong">8.2 May be wrong</h3><p>Wrap four backslashes</p><h4 id="8-2-1-Unbroken-equation">8.2.1 Unbroken equation:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bequation%7D%20%5Clabel%7Beq2%7D%0A%20%20%5Cbegin%7Baligned%7D%0A%20%20a%20%26%3D%20b%20%2B%20c%20%20%5C%5C%0A%20%20%20%20%26%3D%20d%20%2B%20e%20%2B%20f%20%2B%20g%20%5C%5C%0A%20%20%20%20%26%3D%20h%20%2B%20i%20%5C%5C%0A%20%20%5Cend%7Baligned%7D%0A%20%20%5Cend%7Bequation%7D%0A"></p><h4 id="8-2-2-Equation-does-not-break-lines-and-does-not-support-multi-line-numbering">8.2.2 Equation does not break lines and does not support multi-line numbering:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Balign%7D%0A%20%20a%20%26%3D%20b%20%2B%20c%20%5Clabel%7Beq3%7D%20%5C%5C%0A%20%20x%20%26%3D%20yz%20%5C%5C%0A%20%20l%20%26%3D%20m%20-%20n%20%5C%5C%0A%20%20%5Cend%7Balign%7D%0A"></p><h4 id="8-2-3-Multi-column-unbroken-rows-are-not-numbered">8.2.3 Multi-column unbroken rows are not numbered:</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Balign%7D%0A%20%20-4%20%2B%205x%20%26%3D%202%2By%20%5C%5C%0A%20%20w%2B2%20%26%3D%20-1%2Bw%20%5C%5C%0A%20%20ab%20%26%3D%20cb%20%5C%5C%0A%20%20%5Cend%7Balign%7D%20%0A"></p><h4 id="8-2-4-Matrix-is-not-broken：">8.2.4 Matrix is not broken：</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%20%20%5Cbegin%7Bpmatrix%7D%0A%20%201%20%26%20a_1%20%26%20a_1%5E2%20%26%20%5Ccdots%20%26%20a_1%5En%20%5C%5C%0A%20%201%20%26%20a_2%20%26%20a_2%5E2%20%26%20%5Ccdots%20%26%20a_2%5En%20%5C%5C%0A%20%20%5Cvdots%20%26%20%5Cvdots%20%26%20%5Cvdots%20%26%20%5Cddots%20%26%20%5Cvdots%20%5C%5C%0A%20%201%20%26%20a_m%20%26%20a_m%5E2%20%26%20%5Ccdots%20%26%20a_m%5En%20%5C%5C%0A%20%20%5Cend%7Bpmatrix%7D%0A"></p><h4 id="8-2-5-Branching-equations-do-not-wrap">8.2.5 Branching equations do not wrap</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=f%28n%29%3D%0A%5Cbegin%7Bcases%7D%0An%2F2%2C%26%20%5Ctext%7Bif%20%24n%24%20is%20even%7D%5C%5C%0A3n%2B1%2C%26%20%5Ctext%7Bif%20%24n%24%20is%20odd%7D%0A%5Cend%7Bcases%7D%0A"></p><h4 id="8-2-6-Tabular-array">8.2.6 Tabular array</h4><p style="filter:opacity(90%);transform:scale(.85)"><img data-src="https://math.now.sh?from=%5Cbegin%7Barray%7D%7Bc%7Clcr%7D%0An%20%26%20%5Ctext%7BLeft%7D%20%26%20%5Ctext%7BCenter%7D%20%26%20%5Ctext%7BRight%7D%20%5C%5C%0A%5Chline%0A1%20%26%200.24%20%26%201%20%26%20125%20%5C%5C%0A2%20%26%20-1%20%26%20189%20%26%20-8%20%5C%5C%0A3%20%26%20-20%20%26%202000%20%26%201%2B10i%0A%5Cend%7Barray%7D%0A"></p><h3 id="9-Media">9 Media</h3><h4 id="9-1-Images">9.1 Images</h4><p><img data-src="https://1.s91i.faiusr.com/4/AFsIABAEGAAgztrP8QUohNjw0AYwhAc4-wI!800x800.png?v=1580461392155" alt="Caption 9-1 Write picture description here"><br>Supports jpg, png, gif, svg and other image formats, examples of svg files are as follows：<br><img data-src="https://my-wechat.mdnice.com/mdnice/i_am_svg_20191024083453.svg" alt="Caption 9-2 i_am_svg_20191024083453"></p><h3 id="10-Special">10 Special</h3><p><strong>Generally not used unless absolutely necessary</strong></p><h4 id="10-1-HTML">10.1 HTML</h4><p><span style="display:block;text-align:left;color:#ff0036">Tmall Red Home Left</span><br><span style="display:block;text-align:right;color:#ff6a00">Ali Orange Right</span><br><span style="display:block;text-align:center;color:#019fe8">Alipay Centered</span></p><h3 id="10-2-Comments-not-parsed">10.2 Comments (not parsed)</h3><hr class="footnotes-sep"><h2 id="-参考文献" class="footnotes-meta en">REFERENCES</h2><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Ant design.设计模式[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9hbnQuZGVzaWduL2RvY3Mvc3BlYy9pbnRyb2R1Y2UtY24=" title="https://ant.design/docs/spec/introduce-cn">https://ant.design/docs/spec/introduce-cn<i class="fa fa-external-link"></i></span> .2020 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Github.Mastering Markdown[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9ndWlkZXMuZ2l0aHViLmNvbS9mZWF0dXJlcy9tYXN0ZXJpbmctbWFya2Rvd24v" title="https://guides.github.com/features/mastering-markdown/">https://guides.github.com/features/mastering-markdown/<i class="fa fa-external-link"></i></span> .2014 <a href="#fnref2" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      <categories>
        <category>test</category>
      </categories>
      <tags>
        <tag>markdown</tag>
        <tag>test</tag>
        <tag>webhook</tag>
      </tags>
  </entry>
  <entry>
    <title>基于云开发构建markdown，git同步hexo静态站点与小程序</title>
    <url>/blog_basied_on_git/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="1-背景">1 背景</h2><p>本文通过对markdown内容发布、同步、展示由浅入深的分析与实践，构建出一个相对可靠的博文编写、知识沉淀工作流，精简工具的同时提升阅读体验，更好的记录、分享和交流传播。</p><h2 id="2-需求分析">2 需求分析</h2><ul><li>专注于用Markdown写文档，为了实现正常解析，使用通用语法支持；</li><li>一端书写，多端同步：小程序、静态站点，高效的持续集成；</li><li>快速的资源加载，优雅的排版。</li></ul><p>但是要明晰项目边界：</p><ul><li>不需要满足随时随地写文章,因为随时随地写的大部分是随笔、记录一类的帖子，若要呈现出来，必然要经过整理；</li><li>不需要自定义主题风格,博客就主体业务类型(除了评论、点赞、收藏)而言受众个性色彩不强。</li></ul><h2 id="3-系统设计">3 系统设计</h2><h3 id="3-1-概要设计">3.1 概要设计</h3><h4 id="3-1-1-架构设计">3.1.1 架构设计</h4><p>主要思路是本地编辑文章，通过git进行增删改管理，通过云端同步构建到小程序和静态站点。因此，这种思路适用于静态构建markdown文档的框架如hexo、jekyll等。<br><img data-src="https://cdn.blog.makergyt.com/images/project-blog_basied_on_git-3_1_process.png?imageView2/3/h/350" alt="图3-1 主流程图"></p><h4 id="3-1-2-技术选型与开发框架">3.1.2 技术选型与开发框架</h4><p>在开发框架上，由于首次应用于微信小程序，可能存在未知问题，故使用原生开发，不使用多端或其他预编译框架。在小程序UI上，参考但不依赖WeUI组件库，因由于封装不必要的特性可能造成代码包的冗余。</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">方案</th><th>备注</th></tr></thead><tbody><tr><td style="text-align:center">代码托管</td><td style="text-align:center"><span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vZlhtcTRSYjk=" title="https://url.cn/fXmq4Rb9">Coding<i class="fa fa-external-link"></i></span></td><td>github api访问较大概率慢且不稳定</td></tr><tr><td style="text-align:center">云开发</td><td style="text-align:center"><span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vSHFMSFgzeDY=" title="https://url.cn/HqLHX3x6">腾讯云TCB<i class="fa fa-external-link"></i></span></td><td>含小程序云开发服务</td></tr><tr><td style="text-align:center">持续集成</td><td style="text-align:center">Coding CI</td><td>使用Jenkinsfile定义pipeline</td></tr><tr><td style="text-align:center">静态托管</td><td style="text-align:center"><span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vbGh6cklnZVg=" title="https://url.cn/lhzrIgeX">腾讯云COS<i class="fa fa-external-link"></i></span></td><td>也可使用<span class="exturl" data-url="aHR0cHM6Ly93d3cuYWxpeXVuLmNvbS9wcm9kdWN0L29zcz9zb3VyY2U9NTE3Ni4xMTUzMzQ1NyZhbXA7dXNlckNvZGU9ODlsZm5mM3EmYW1wO3R5cGU9Y29weQ==" title="https://www.aliyun.com/product/oss?source=5176.11533457&amp;userCode=89lfnf3q&amp;type=copy">阿里云OSS<i class="fa fa-external-link"></i></span>,或直接使用云开发提供的<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9wcm9kdWN0L3do" title="https://cloud.tencent.com/product/wh">静态网站托管<i class="fa fa-external-link"></i></span>,使用<span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vOFNVd09nc2Q=" title="https://url.cn/8SUwOgsd">对象存储<i class="fa fa-external-link"></i></span>配合<span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vcGFEN0U4bGI=" title="https://url.cn/paD7E8lb">内容分发加速<i class="fa fa-external-link"></i></span>。</td></tr><tr><td style="text-align:center">Markdown解析</td><td style="text-align:center">markdown-it</td><td>也可使用markdjs,但markdown-it支持拓展插件</td></tr><tr><td style="text-align:center">富文本渲染</td><td style="text-align:center"><span class="exturl" data-url="aHR0cHM6Ly9qaW4teXVmZW5nLmdpdGh1Yi5pby9QYXJzZXIvIy8=" title="https://jin-yufeng.github.io/Parser/#/">parser<i class="fa fa-external-link"></i></span></td><td>比原生rich-text功能丰富且效果稳定</td></tr></tbody></table><h4 id="3-1-3-界面设计">3.1.3 界面设计</h4><p>由于是内容类应用，需要格外注意视觉规范，以使用户获取较好的阅读体验。以下规范参考了&quot;WEDESIGN&quot;和&quot;Ant Design&quot;,根据实际需要进行了修改和补充。<br>对于文本要求：字间距0.05em，行间距1.8(此处为行高)，段间距，对字体有如下设定:</p><table><thead><tr><th style="text-align:center">字号pt</th><th style="text-align:center">像素px</th><th style="text-align:center">颜色</th><th>用途</th></tr></thead><tbody><tr><td style="text-align:center">17</td><td style="text-align:center">17</td><td style="text-align:center">#000000</td><td>页面内首要层级信息,标题</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">14</td><td style="text-align:center">#888888</td><td>页面内次要描述信息，搭配列表标题</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">14</td><td style="text-align:center">#353535</td><td>大段文本</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">13</td><td style="text-align:center">#576b95</td><td>链接</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">13</td><td style="text-align:center">#B2B2B2</td><td>页面辅助信息，需弱化的内容</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">13</td><td style="text-align:center">#09bb07</td><td>完成字样</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">13</td><td style="text-align:center">#e64340</td><td>出错字样</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">11</td><td style="text-align:center">rgba(0, 0, 0, 0.3)</td><td>说明文本，如版权信息等不需要用户关注的信息</td></tr></tbody></table><p>对于图标有如下:</p><table><thead><tr><th style="text-align:center">类别</th><th style="text-align:center">颜色</th><th style="text-align:center">大小</th></tr></thead><tbody><tr><td style="text-align:center">导航类</td><td style="text-align:center">可多色，但不多于三色,主色一致</td><td style="text-align:center">28px</td></tr><tr><td style="text-align:center">菜单操作类</td><td style="text-align:center">单色,颜色统一</td><td style="text-align:center">22px</td></tr><tr><td style="text-align:center">操作提示类</td><td style="text-align:center">与提示类型相关</td><td style="text-align:center">30px</td></tr><tr><td style="text-align:center">展示区分类</td><td style="text-align:center">图标固有色彩</td><td style="text-align:center">与跟随字体大小一致</td></tr></tbody></table><p>响应式设计:<br>主要通过使用rpx作为尺寸单位，由于基本不涉及列表项目，不考虑自适应布局变换，仅做不同屏幕下元素呈现比例保持一致，以iphone-6作为标准，考虑如下方面</p><ul><li>图片横向铺满屏幕时按比例填充；</li><li>主体文本字体大小基本固定，不做适应；</li><li>由于已经有静态站点，且PC端基础库尚未支持到2.11.0，暂不考虑PC端适配；</li><li>内容间隙适应。</li></ul><p>对于iphone-x类异形屏，重点考虑操作菜单(如贴顶、贴底、悬浮)的安全区域问题，可通过CSS中<code>env(safe-area-inset-bottom)</code>设定。</p><h4 id="3-1-4-开发规范">3.1.4 开发规范</h4><p>有以下几点原则：</p><ul><li>渐进式，先实现基本功能，再考虑抽离和组件化；</li><li>能用简单的逻辑实现就不抽离组件，能使用成熟库就不自行创建组件，能通过配置或迁就性使用就不修改外部库以保证平滑更新；</li><li>对于功能实现的方式，要考虑服务角色,权衡计算复杂度、网络延时和用户感知程度:</li></ul><p>小程序端做简单计算</p><ul><li>canvas绘制海报</li><li>基本格式转换</li></ul><p>服务端(云开发)做复杂处理,非实时性计算，或可预生成的内容</p><ul><li>markdown转html</li><li>目录</li><li>对于读写数据库，尽量将写操作放在云函数中。</li></ul><h3 id="3-2-详细设计">3.2 详细设计</h3><h4 id="3-2-1-数据源">3.2.1 数据源</h4><p>安全校验，保证云函数触发来源及方式可信:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查看请求头</span></span><br><span class="line"><span class="keyword">if</span> (!req.headers[<span class="string">'user-agent'</span>].includes(<span class="string">'Coding.net Hook'</span>) || </span><br><span class="line">    !(<span class="string">'x-coding-signature'</span> <span class="keyword">in</span> req.headers) || req.headers[<span class="string">'x-coding-signature'</span>].indexOf(<span class="string">'sha1='</span>)</span><br><span class="line">    !(<span class="string">'x-coding-event'</span> <span class="keyword">in</span> req.headers) || <span class="string">'POST'</span> !== req.httpMethod ) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 计算和比对签名</span></span><br><span class="line"><span class="keyword">const</span> theirSignature = req.headers[<span class="string">'x-coding-signature'</span>];</span><br><span class="line"><span class="keyword">const</span> payload = req.body;</span><br><span class="line"><span class="keyword">const</span> secret = process.env.HOOKTOKEN;</span><br><span class="line"><span class="keyword">const</span> ourSignature = <span class="string">`sha1=<span class="subst">$&#123;crypto.createHmac(<span class="string">'sha1'</span>, secret).update(payload).digest(<span class="string">'hex'</span>)&#125;</span>`</span>;</span><br><span class="line"><span class="keyword">return</span> crypto.timingSafeEqual(Buffer.from(theirSignature), Buffer.from(ourSignature));</span><br></pre></td></tr></table></figure><p>在每次commit推送新的代码时，WebHook会push以下信息(限于篇幅，略去非必要信息)</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"ref"</span>: <span class="string">"refs/heads/master"</span>,</span><br><span class="line">  <span class="attr">"commits"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"8a175afab1cf117f2e1318f9b7f0bc5d4dd54d45"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1592488968000</span>,</span><br><span class="line">    <span class="attr">"author"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"memakergytcom"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"me@makergyt.com"</span>,</span><br><span class="line">      <span class="attr">"username"</span>: <span class="string">"memakergytcom"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    ]&#125;</span><br><span class="line">  ],</span><br><span class="line">  "head_commit":&#123;</span><br><span class="line">    "added": [</span><br><span class="line">      <span class="string">"source/_drafts/site.md"</span></span><br><span class="line">    ],</span><br><span class="line">    "removed": [],</span><br><span class="line">    "modified": [</span><br><span class="line">      "package.json",</span><br><span class="line">      "scripts/fix.js",</span><br><span class="line">      "source/_posts/next.yml",</span><br><span class="line">      <span class="string">"source/_posts/typesetting.md"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  "pusher",</span><br><span class="line">  "sender",</span><br><span class="line">  <span class="string">"repository"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保持最新状态故关注&quot;head_commit&quot;中的added,removed和modified。这些信息包含了本次提交产生的变更，可以基于遍历这些变更状态，同步云数据库。但由于可能包含了非文章文件的变更，也可能非目标分支，故需要筛选:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">'refs/heads/'</span> + branch === ref) &#123;</span><br><span class="line">  <span class="keyword">if</span> (filePath.indexOf(dirPrefix) || filePath.slice(<span class="number">-3</span>) !== <span class="string">'.md'</span>) &#123;　<span class="comment">// 路径前缀和文章后缀</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要建立数据库文件与git仓库文件的关联，由于每次commit的文件没有唯一id信息,可以通过文件名来建立联系，将文件名作为slug字段(主键)，应注意文件名不得含有空格，必须使用半角字符<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，多个单词使用<code>_</code>分隔。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> slug = filePath.match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(dirPrefix + <span class="string">"([\\s\\S]+)\\.md"</span>))[<span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>由于Push 事件不包含文件内容，需要通过api发起请求</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">await</span> axios(&#123;</span><br><span class="line">  url: <span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>/<span class="subst">$&#123;branch&#125;</span>/<span class="subst">$&#123;filePath&#125;</span>`</span>,</span><br><span class="line">  method: <span class="string">'get'</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">'Authorization'</span>: <span class="string">`token <span class="subst">$&#123;process.env.CODINGTOKEN&#125;</span>`</span> <span class="comment">// 个人令牌</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3-2-2-数据处理">3.2.2 数据处理</h4><p>提取文章信息:<br>由于要求在markdown开头通过yaml格式写明基本信息，故在获取到文件内容(String)后需要提取。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> matter = <span class="built_in">require</span>(<span class="string">'hexo-front-matter'</span>);</span><br><span class="line"><span class="keyword">let</span> &#123; title, date, tags, description, categories, _content, cover &#125; = matter.parse(data);</span><br></pre></td></tr></table></figure><p>其中cover字段(封面图)也可不声明，而通过文章首图来获取</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cover = _content.match(<span class="regexp">/!\[.*\]\((.+?)\)/</span>);</span><br></pre></td></tr></table></figure><p>markdown解析html:<br>小程序端环境与传统网页有区别，让markdown渲染在本地进行，其中还需要先转为html。为了减少渲染时间，这一步在云端提前进行:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> md = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>)(&#123;</span><br><span class="line">  html: <span class="literal">true</span>,<span class="comment">// 允许渲染html</span></span><br><span class="line">&#125;).use(<span class="built_in">require</span>(<span class="string">'markdown-it-footnote'</span>))　<span class="comment">// 通过脚注引用生成参考文献</span></span><br></pre></td></tr></table></figure><p>生成目录时，为了便于自定义和保持一致，章节自行标号。为了便于操作，目录不会解析到主体html中。而markdown-it-anchor插件会使用header的值作为id，但id不能以数字开头，不能含中文及encodeURIComponent(中文)，但可以含<code>-</code>，需进行转换。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为&lt;h&gt;标签插入id</span></span><br><span class="line">id = <span class="string">'makergyt-'</span> + crypto.createHash(<span class="string">'md5'</span>).update(title).digest(<span class="string">'hex'</span>);</span><br><span class="line"><span class="comment">// 获取所有h2-h4生成目录列表</span></span><br><span class="line"><span class="keyword">const</span> &#123; tocObj &#125; = <span class="built_in">require</span>(<span class="string">'hexo-util'</span>);</span><br><span class="line"><span class="keyword">const</span> data = tocObj(str, &#123; <span class="attr">min_depth</span>:<span class="number">2</span>, <span class="attr">max_depth</span>: <span class="number">4</span> &#125;);</span><br></pre></td></tr></table></figure><h4 id="3-2-3-数据同步">3.2.3 数据同步</h4><p>在小程序的文档中，触发云函数可以通过http api（invokeCloudFunction）的方式。但是invokeCloudFunction需要关键的access_token，需要两小时内刷新获取，webhook无法提前获知。考虑设置中控服务器统一获取和刷新 access_token，webhook首先向中控服务器发起请求，再向云函数请求，但这样显然是不可能的，因其只能push一个地址一次，没有上下文。其间再加一个中间函数，那么这个中间函数又放在哪里，如何请求…(同样需要access_token)</p><p>这时，在<span class="exturl" data-url="aHR0cHM6Ly91cmwuY24vWkhFeEhVQ2E=" title="https://url.cn/ZHExHUCa">腾讯云－云开发控制台<i class="fa fa-external-link"></i></span>，发现可以直接通过&quot;云接入HTTP触发方式&quot;触发云函数，这样就可以直接该地址作为WebHook的Url。但需要关注业务和资源安全<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>,上文在处理webhook push事件时已经做了安全检验，可以再将Coding的request domain加入到WEB安全域名列表中。</p><p>获取到文章信息和内容后就可以同步到云数据库的相应集合中,这里循环中使用<code>async/await</code>遍历,为了在每个调用解析之前保持循环,只使用<code>for...of</code>进行异步<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> added) &#123;</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">'sync_posts'</span>).add(&#123;</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> modified) &#123;</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">'sync_posts'</span>).where(&#123;</span><br><span class="line">    slug</span><br><span class="line">  &#125;).update(&#123;</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> removed) &#123;</span><br><span class="line">  <span class="keyword">await</span> syncPosts.where(&#123;</span><br><span class="line">    slug</span><br><span class="line">  &#125;).remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.blog.makergyt.com/images/project-blog_basied_on_git-3_2_request.png?imageView2/3/h/200" alt="图3-2 数据同步流程图"></p><h4 id="3-2-4-文本渲染">3.2.4 文本渲染</h4><p>几乎不太可能将原内容原封不动显示出来, 经过markdown-it渲染后的html字符串没有插入任何样式,直接测试(组件根据标签默认提供样式)效果如下:</p><table><thead><tr><th>方案</th><th>效果</th></tr></thead><tbody><tr><td>rich-text</td><td>代码块缺失，长内容被截断</td></tr><tr><td>wxparser</td><td>间距过大，表格、代码块被截断</td></tr><tr><td>towxml</td><td>代码块被截断</td></tr><tr><td>wemark</td><td>代码块与引用部分不换行拉宽</td></tr><tr><td>Parser</td><td>表格溢出</td></tr></tbody></table><p><em>Tips</em>: 注意到腾讯Omi团队开发的小程序代码高亮和markdown渲染组件<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvb21pL3RyZWUvbWFzdGVyL3BhY2thZ2VzL2NvbWkvbXAvY29taQ==" title="https://github.com/Tencent/omi/tree/master/packages/comi/mp/comi">Comi<i class="fa fa-external-link"></i></span>，实际上采用模板引入的方式使用。考虑随后实测效果和对比渲染速度。</p><p>相比之下，都会出现溢出组件边界，产生横向滚动条问题。在使用上，存在不支持解析style标签缺陷<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><p><img data-src="https://imgkr.cn-bj.ufileos.com/9781bc4f-de66-4338-a993-21cfc987b405.png?imageView2/3/h/200" alt="图3-3 表格溢出"></p><p>而Parser可以通过控制源html样式的方法解决这种问题</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">document</span> = that.selectComponent(<span class="string">"#article"</span>).document;</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">'table'</span>).forEach(<span class="function"><span class="params">tableNode</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> div=<span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">  div.setStyle(<span class="string">"overflow"</span>, <span class="string">"scroll"</span>);</span><br><span class="line">  div.appendChild(tableNode);</span><br><span class="line">  div._path = tableNode._path;</span><br><span class="line">  tableNode = div;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>同样可以预先设定html中标签样式来影响渲染效果，这样就可以改变字体大小、行高、行间距等，以适应移动端阅读。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//post.wxml</span></span><br><span class="line">&lt;parser id=<span class="string">"article"</span> tag-style=<span class="string">"&#123;&#123;tagStyle&#125;&#125;"</span>/&gt;</span><br><span class="line"><span class="comment">// post.js</span></span><br><span class="line">tagStyle: &#123;</span><br><span class="line">  p: <span class="string">'font-size: 14px;color: #353535;line-height: 2;font-family: "Times New Roman";'</span>,</span><br><span class="line">  h2: <span class="string">'font-size: 18.67px;color: #000;text-align:center;margin: 1em auto;font-weight: 500;font-family: SimHei;'</span>,</span><br><span class="line">  h3: <span class="string">'font-size:16.33px;color: #000;line-height: 2em;font-family: SimHei;'</span>,</span><br><span class="line">  h4: <span class="string">'font-size:14px;color: #000;font-family: SimHei;'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于代码高亮，使用<span class="exturl" data-url="aHR0cHM6Ly9wcmlzbWpzLmNvbS8=" title="https://prismjs.com/">prism <i class="fa fa-external-link"></i></span>,引入到该组件中。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Prism = <span class="built_in">require</span>(<span class="string">'./prism.js'</span>);</span><br><span class="line">...</span><br><span class="line">highlight(content, attrs) &#123;</span><br><span class="line">  content = content.replace(<span class="regexp">/&amp;lt;/g</span>, <span class="string">'&lt;'</span>).replace(<span class="regexp">/&amp;gt;/g</span>, <span class="string">'&gt;'</span>).replace(<span class="regexp">/quot;/g</span>, <span class="string">'"'</span>).replace(<span class="regexp">/&amp;amp;/g</span>, <span class="string">'&amp;'</span>); <span class="comment">// 替换实体编码</span></span><br><span class="line">  attrs[<span class="string">"data-content"</span>] = content; <span class="comment">// 记录原始文本，可用于长按复制等操作</span></span><br><span class="line">  <span class="keyword">switch</span> (attrs[lan]) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"javascript"</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"js"</span>:</span><br><span class="line">      <span class="keyword">return</span> Prism.highlight(content, Prism.languages.javascript, <span class="string">"javascript"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而对于数学公式Latex,渲染引擎主要有两种:</p><table><thead><tr><th>引擎</th><th>特点</th></tr></thead><tbody><tr><td>mathjax</td><td>语法丰富，渲染较慢</td></tr><tr><td>katex</td><td>支持语法较少，迅速,只能输出mathml或html,需要搭配其CSS and font files使用</td></tr></tbody></table><p>当然，这两种都是网页客户端渲染，在小程序端天生不可用，考虑采用服务端渲染。问题有:</p><ul><li>服务端渲染如果使用外部接口，需encodeUrl(公式)，但内部<code>\</code>被转义消失，需要<code>\\</code>，replace(/\/g,’\’)无效</li><li>服务端渲染如果使用mathjax-node,其依赖项mathjax版本^2.7.2，需将所有<code>\</code>替换为<code>\\</code>,会经常性出现<code>SVG - Unknown character</code>与矩阵解析错误<code>TeX parse error: Misplaced &amp;</code></li><li>如何比较精准的识别markdown中特定标记的Latex，不造成误处理。</li></ul><p>考虑在markdown解析html阶段就将其转化为<code>&lt;img&gt;</code>，也是很多内容平台采取的方式，较为可靠可控。这里使用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL21hcmtkb3duLWl0LWxhdGV4MmltZw==" title="https://github.com/MakerGYT/markdown-it-latex2img">markdown-it-latex2img<i class="fa fa-external-link"></i></span>插件，在书写上遵循一定的规范<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>以避免误处理。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> md = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>)(&#123;</span><br><span class="line">  html: <span class="literal">true</span>,<span class="comment">// Enable HTML tags in source</span></span><br><span class="line">&#125;).use(<span class="built_in">require</span>(<span class="string">'markdown-it-latex2img'</span>),&#123;</span><br><span class="line">    style: <span class="string">"filter: opacity(90%);transform:scale(0.85);text-align:center;"</span> <span class="comment">//　优化显示样式</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p><img data-src="https://imgkr.cn-bj.ufileos.com/5be6b53b-c3dc-4119-9683-09d650858558.jpeg?imageView2/3/h/200" alt="图3-4 markdown-it-latex2img效果"></p><h3 id="3-3-静态托管">3.3 静态托管</h3><p>为git库设置构建计划，以使每次提交后同步到对象存储。这里使用hexo作为构建框架。<br><img data-src="https://cdn.blog.makergyt.com/images/project-blog_basied_on_git-3_5_static.png?imageView2/3/h/200" alt="图3-5 静态托管流程"><br>构建后自动刷新CDN,</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// refresh_cdn</span></span><br><span class="line"><span class="keyword">const</span> Key = <span class="built_in">decodeURIComponent</span>(event.Records[<span class="number">0</span>].cos.cosObject.key.replace(<span class="regexp">/^\/[^/]+\/[^/]+\//</span>,<span class="string">""</span>));</span><br><span class="line"><span class="keyword">const</span> cdnUrl = <span class="string">`<span class="subst">$&#123;process.env.CDN_HOST&#125;</span>/<span class="subst">$&#123;Key&#125;</span>`</span>;</span><br><span class="line">CDN.request(<span class="string">'RefreshCdnUrl'</span>, &#123;</span><br><span class="line">    <span class="string">'urls.0'</span>: cdnUrl</span><br><span class="line">&#125;, (res) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-系统实现">4 系统实现</h2><h3 id="4-1-数据库">4.1 数据库</h3><p>文章:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sync_posts = [</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="built_in">String</span>,</span><br><span class="line">    createTime: <span class="built_in">String</span>,</span><br><span class="line">    slug: <span class="built_in">String</span>,</span><br><span class="line">    title: <span class="built_in">String</span>,</span><br><span class="line">    tags: <span class="built_in">Array</span>,</span><br><span class="line">    description: <span class="built_in">String</span>,</span><br><span class="line">    cover: <span class="built_in">String</span>, <span class="comment">// url</span></span><br><span class="line">    content: <span class="built_in">String</span>, <span class="comment">// html</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 安全规则</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"read"</span>: <span class="literal">true</span>, <span class="comment">// 公有读</span></span><br><span class="line">  <span class="string">"write"</span>: <span class="string">"get('database.user_info.$&#123;auth.openid&#125;').isManager"</span>, <span class="comment">// 仅管理员可以写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用户收藏</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user_favorite = [</span><br><span class="line">  &#123;</span><br><span class="line">    _id:<span class="built_in">String</span>,</span><br><span class="line">    userId:<span class="built_in">String</span>,<span class="comment">// openid</span></span><br><span class="line">    postId: <span class="built_in">String</span>,<span class="comment">// 在表中加入冗余数据直接查询</span></span><br><span class="line">    createTime: <span class="built_in">Date</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 安全规则</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"read"</span>: <span class="string">"doc._openid == auth.openid"</span>,<span class="comment">// 私有读</span></span><br><span class="line">  <span class="string">"write"</span>: <span class="string">"doc._openid == auth.openid"</span><span class="comment">// 私有写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用户信息</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user_info = [</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="built_in">String</span>,</span><br><span class="line">    _openid: <span class="built_in">String</span>,</span><br><span class="line">    ...userInfo,</span><br><span class="line">    isManager: <span class="built_in">Boolean</span>,</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 安全规则</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"read"</span>: <span class="string">"doc._openid == auth.openid"</span>, <span class="comment">// 私有读</span></span><br><span class="line">  <span class="string">"write"</span>: <span class="string">"doc._openid == auth.openid"</span><span class="comment">// 私有写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-登录">4.2 登录</h3><h4 id="4-2-1-普通登录">4.2.1 普通登录</h4><p>使用云开发后，无需通过wx.login获取登录凭证（code）进而换取用户登录态信息，因为每次调用云函数时已经附带调用者openid。由于可以直接通过open-data展示用户信息(不论是否授权),一些小程序因此绕过用户登录；有些小程序通过授权用户信息后保存到数据库，后续操作均使用数据库信息，无法在用户变更信息后更新；如果用户主动通过设置页取消授权，但返回后却还在展示使用用户的信息(显示已登录)。这是因为用户态信息是通过onLoad获取的，返回操作时是onShow,故此时会产生矛盾；用户在重新授权登录时选择使用其他昵称和头像，这时一些小程序会认为是新用户登录；还有一部分小程序不论业务中是否需要用户信息，均要求授权才可使用。</p><p>实际上微信小程序最大的特点就是可以方便地获取微信提供的用户身份标识，快速建立小程序内的用户体系，但上述情形均没有妥善处理用户登录这一基本策略。</p><p>基于&quot;来去自如&quot;<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup>的原则,可以游客身份浏览，但在涉及一些需要采集和输入用户信息、或保存用户记录的功能时会要求用户跳至登录页授权获取信息，通过云函数将其与上下文中的openid保存到数据库，同时在回调中将用户标识生成自定义登录态缓存到本地，如果用户点击退出会将其置空。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cloudfunction/login</span></span><br><span class="line"><span class="keyword">const</span> openid = wxContext.OPENID</span><br><span class="line">db.collection(<span class="string">'user_info'</span>).where(&#123;</span><br><span class="line">  _openid: openid</span><br><span class="line">&#125;).get().then(<span class="keyword">async</span> (res)=&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.data.length === <span class="number">0</span>) &#123;</span><br><span class="line">    db.collection(<span class="string">'user_info'</span>).add(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        _openid: openid,</span><br><span class="line">        ...event.userInfo,</span><br><span class="line">        createTime: db.serverDate(),</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>在下次打开小程序时，会通过检查缓存中的自定义登录态来判断用户是否登录，同样调用云函数来更新用户信息和使用信息(如打开时间、打开次数用于后续用户分析)。在下次登录时将不会弹出授权提示，当用户自行取消授权(或者wx.openSetting时误操作)，这种情况概率很小，但一旦出现就是Bug。如果在onShow中监测，会与正常onLaunch产生重复的逻辑。实际上，打开设置页必然会进入onHide，可以如下监测:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">onHide:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  wx.onAppShow(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.globalData.hasLogin) &#123;</span><br><span class="line">      wx.getSetting(&#123;</span><br><span class="line">        success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!res.authSetting[<span class="string">'scope.userInfo'</span>]) &#123; <span class="comment">// 取消了授权</span></span><br><span class="line">            <span class="keyword">this</span>.logout() <span class="comment">// 返回后直接登出</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    wx.offAppShow();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="4-2-2-管理员鉴权">4.2.2 管理员鉴权</h4><p>管理员即文章作者，对于管理员标识，考虑到</p><ul><li>手机号: 目前该接口针对非个人开发者，且完成了认证的小程序开放</li><li>openid: 不使用前是未知的，无法提前绑定</li><li>用户信息是可变的不可绑定</li><li>密码方式会暴露管理入口</li></ul><p>于是暂时采取了最简单直接的数据字段标记<code>isMaganer:true</code>,这一字段也会用于数据库的安全规则设定。</p><h3 id="4-3-分享">4.3 分享</h3><p>分享无非两种，直接分享到聊天和生成海报后引导分享到朋友圈，对于前者，需要考虑图片大小为5:4,其他比例会产生空白或者裁切。这里主要分析后者。在小程序端通过canvas绘制导出图片比较慢，由于每篇文章分享内容基本固定，可以考虑预生成。但如果分享二维码和分享者关联，就仍然需要本地生成。这里使用组件<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL3NoYXJl" title="https://github.com/MakerGYT/share">mini-share<i class="fa fa-external-link"></i></span>。对于小程序码，目前采用云调用方式，这种方式只能从小程序端触发,故不能预生成。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理参数</span></span><br><span class="line"><span class="keyword">const</span> path = page +<span class="string">'?'</span> + <span class="built_in">Object</span>.keys(param).map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(key) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(param[key]);</span><br><span class="line">&#125;).join(<span class="string">"&amp;"</span>);</span><br><span class="line"><span class="comment">// 组织文件名</span></span><br><span class="line"><span class="keyword">const</span> fileName = <span class="string">'wxacode/limitA-'</span> + crypto.createHash(<span class="string">'md5'</span>).update(path).digest(<span class="string">'hex'</span>);</span><br><span class="line"><span class="comment">// 查找文件,如果找到直接返回路径</span></span><br><span class="line"><span class="keyword">let</span> getFileRes = <span class="keyword">await</span> cloud.getTempFileURL(&#123;</span><br><span class="line">  fileList: [fileID]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 若未找到重新生成</span></span><br><span class="line"><span class="keyword">const</span> wxacodeRes = <span class="keyword">await</span> cloud.openapi.wxacode.get(&#123;</span><br><span class="line">  path,</span><br><span class="line">  isHyaline:<span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 上传到云存储</span></span><br><span class="line"><span class="keyword">const</span> uploadRes = <span class="keyword">await</span> cloud.uploadFile(&#123;</span><br><span class="line">  cloudPath: fileName + fileSuffix,</span><br><span class="line">  fileContent: wxacodeRes.buffer,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取返回临时路径</span></span><br><span class="line">getFileRes = <span class="keyword">await</span> cloud.getTempFileURL(&#123;</span><br><span class="line">  fileList: [uploadRes.fileID]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>生成二维码方式有三种，分析特性</p><table><thead><tr><th>类型</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>A/C</td><td>个数有限、参数较长</td><td>生成后储存　用于长期有效业务，可用于邀请码一类用户可长期关注使用的操作。</td></tr><tr><td>B</td><td>个数无限、参数较短</td><td>生成后可不保存，其scene与用户短期行为关联（如活动）。活码，与数据库关联后可以转换含义再次使用。</td></tr></tbody></table><p>这里由于文章的数据库<code>_id</code>默认是32位，达到了B类的限制，并且还需要关联其他信息，故使用了A类(wxacode.get)</p><h3 id="4-4-订阅消息">4.4 订阅消息</h3><p>对于个人主体，只能用户经小程序发起订阅(获取下发权限)后下发一次消息，这里当用户留言时，会订阅一次回复通知,但无法发给作者(除非作者长期订阅)。由于同时需要保存到数据库，这里采用云调用实现。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// post.js</span></span><br><span class="line">wx.requestSubscribeMessage(&#123;</span><br><span class="line">  tmplIds: [TEMPLATE.REPLY]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// cloudfunction/sengMsg</span></span><br><span class="line"><span class="keyword">let</span> sendRes = <span class="keyword">await</span> db.collection(<span class="string">'user_msg'</span>).add(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    _openid: wxContext.OPENID,</span><br><span class="line">    msg:inputMsg,</span><br><span class="line">    createTime:<span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">await</span> cloud.openapi.subscribeMessage.send(&#123;</span><br><span class="line">  data: format(data), <span class="comment">// 由于各种类型信息有长度格式限制，需要处理</span></span><br><span class="line">  touser: wxContext.OPENID,</span><br><span class="line">  templateId: TEMPLATE.REPLY</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="5-拓展总结">5 拓展总结</h2><h3 id="5-1-结合语雀">5.1 结合语雀</h3><h4 id="5-1-1-同步到语雀">5.1.1 同步到语雀</h4><p>语雀为开发者提供了操作api，但是:</p><ul><li>会在标题前插入<code>&lt;a name=&quot;tqO5w&quot;&gt;&lt;/a&gt;</code>标签</li><li>编辑界面直接复制会图片外链转化，但是直接导入的不会转化</li><li>只可从本地导入文件(图片)，均不支持外部链接引入，除了加入的第三方服务</li><li>可以input任意类型，但output都是特有lake格式,且在<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL3l1cXVlL2RldmVsb3Blci9kb2MjYzJlOWVlMmE=" title="https://www.yuque.com/yuque/developer/doc#c2e9ee2a">更新文档<i class="fa fa-external-link"></i></span>接口调用时，会返回</li></ul><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>: <span class="number">400</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"抱歉，语雀不允许通过 API 修改 Lake 格式文档，请到语雀进行操作。"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-1-2-从语雀同步">5.1.2 从语雀同步</h4><p>可以借助<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2xvZ2luP3BsYXRmb3JtPXdlY2hhdCZhbXA7aW52aXRlVG9rZW49ZDI1MGNjZTdhOWJmYjMyMjg4MGYyMGIxZDFjNGNkYzRlMjYzYzQ4NGVmMzkzOTliN2I0YzJmYTI1YzMyYzVjMg==" title="https://www.yuque.com/login?platform=wechat&amp;inviteToken=d250cce7a9bfb322880f20b1d1c4cdc4e263c484ef39399b7b4c2fa25c32c5c2">语雀<i class="fa fa-external-link"></i></span>良好的编辑体验来写文章，同步到其他平台。yuque的webhook会发送webhook.doc_detail可以直接获取到内容。但是，在丰富文档内容类型方面，<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2xvZ2luP3BsYXRmb3JtPXdlY2hhdCZhbXA7aW52aXRlVG9rZW49ZDI1MGNjZTdhOWJmYjMyMjg4MGYyMGIxZDFjNGNkYzRlMjYzYzQ4NGVmMzkzOTliN2I0YzJmYTI1YzMyYzVjMg==" title="https://www.yuque.com/login?platform=wechat&amp;inviteToken=d250cce7a9bfb322880f20b1d1c4cdc4e263c484ef39399b7b4c2fa25c32c5c2">语雀<i class="fa fa-external-link"></i></span>做了很多卓有成效的努力，使用这些特性，也就无法保证其他平台的兼容性。删除操作返回的slug会变为<code>trash-EJA8tL7W</code>，与原slug无关，无法通过slug建立其他平台的关联，即仅增改操作可以同步。因此，在语雀写作，自动部署到其他平台的方案是不切实际和不必要的。</p><h4 id="5-1-3-做法">5.1.3 做法</h4><p>同步至<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2xvZ2luP3BsYXRmb3JtPXdlY2hhdCZhbXA7aW52aXRlVG9rZW49ZDI1MGNjZTdhOWJmYjMyMjg4MGYyMGIxZDFjNGNkYzRlMjYzYzQ4NGVmMzkzOTliN2I0YzJmYTI1YzMyYzVjMg==" title="https://www.yuque.com/login?platform=wechat&amp;inviteToken=d250cce7a9bfb322880f20b1d1c4cdc4e263c484ef39399b7b4c2fa25c32c5c2">语雀<i class="fa fa-external-link"></i></span>后，可以利用其丰富的支持类型完善文档内容，比如将文本内容转化为更直观的流程图、思维导图，将demo和代码合并到codepen直观演示，将可能涉及的资料直接以附件上传方便获取。<br>但要注意：</p><ul><li>很多内容平台往往会在拥有一定用户基数后做图片防盗链。</li><li>目前的webhook设计不安全，没有签名验证，可能由于Webhooks URL泄露被伪造请求</li></ul><h3 id="5-2-小程序开发已知问题">5.2 小程序开发已知问题</h3><ul><li>真机初始动画卡顿500ms</li><li>真机原生TabBar隐藏会跳动，加动画会黑屏，自定义TabBar切换时所有图标会闪动，自动隐藏会显示白条.</li><li>简单几次来回navigate后,listeners of event onBeforeUnloadPage_17 have been added, possibly causing memory leak.</li><li>真机在调用CameraFrameListener.start开始监听帧数据后，必然有对像素data的获取和处理，但这会导致界面所有的点击(bindtap)事件失效，也就不能通过点击触发CameraFrameListener.stop停止函数</li><li>云控制台数据库管理页中数组更新操作符addToSet无效,对象元素传入后<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vY29tbXVuaXR5L2RldmVsb3AvZG9jLzAwMDZlMjk2NmU4ODYwNDI0NDVhNWU2YzQ1NmMwMA==" title="https://developers.weixin.qq.com/community/develop/doc/0006e2966e886042445a5e6c456c00">不稳定<i class="fa fa-external-link"></i></span>，或生效或不生效</li></ul><h3 id="5-3-效果">5.3 效果</h3><ul><li>静态站点: <a href="https://blog.makergyt.com">blog.makergyt.com</a> 备用链接: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuYmxvZy5tYWtlcmd5dC5jb20=" title="https://github.blog.makergyt.com">github.blog.makergyt.com<i class="fa fa-external-link"></i></span></li><li>语雀:<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2Jvb2tzL3NoYXJlLzRiNTEyMjRhLWI4YjAtNDE5MS04NDAzLWQyODU2M2Y2YTZlZD8j" title="https://www.yuque.com/books/share/4b51224a-b8b0-4191-8403-d28563f6a6ed?#">「激扬文字」<i class="fa fa-external-link"></i></span></li><li>小程序：「源创智造」,其中接入了一些工具</li></ul><p><img data-src="https://cdn.blog.makergyt.com/mini/assets/poster-H.png" alt="图5-1 微信扫一扫预览小程序"></p><h3 id="5-4-开源">5.4 开源</h3><p>开源地址：整理中，将会上传于<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21ha2VyZ3l0" title="https://github.com/makergyt">github.com/makergyt<i class="fa fa-external-link"></i></span>,敬请关注。现将部分组件开源:</p><ul><li>弹出式导航 =&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL21pbmktbWVudQ==" title="https://github.com/MakerGYT/mini-menu">https://github.com/MakerGYT/mini-menu<i class="fa fa-external-link"></i></span></li><li>取色器 =&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL21pbmktY29sb3ItcGlja2Vy" title="https://github.com/MakerGYT/mini-color-picker">https://github.com/MakerGYT/mini-color-picker<i class="fa fa-external-link"></i></span></li><li>分享海报 =&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL3NoYXJl" title="https://github.com/MakerGYT/share">https://github.com/MakerGYT/share<i class="fa fa-external-link"></i></span></li><li>提示添加到小程序 =&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL21pbmktYWRkLXRpcHM=" title="https://github.com/MakerGYT/mini-add-tips">https://github.com/MakerGYT/mini-add-tips<i class="fa fa-external-link"></i></span></li><li>latex、mathjax解析通用方案 =&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01ha2VyR1lUL21hcmtkb3duLWl0LWxhdGV4MmltZw==" title="https://github.com/MakerGYT/markdown-it-latex2img">https://github.com/MakerGYT/markdown-it-latex2img<i class="fa fa-external-link"></i></span></li></ul><hr class="footnotes-sep"><h2 id="-参考文献" class="footnotes-meta zh-CN">参 考 文 献</h2><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>阮一峰.中文技术文档规范[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3J1YW55Zi9kb2N1bWVudC1zdHlsZS1ndWlkZQ==" title="https://github.com/ruanyf/document-style-guide">https://github.com/ruanyf/document-style-guide<i class="fa fa-external-link"></i></span>. 2019 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Tencent Cloud.云开发CloudBase文档[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0Lzg3Ni80MTEzNg==" title="https://cloud.tencent.com/document/product/876/41136">https://cloud.tencent.com/document/product/876/41136<i class="fa fa-external-link"></i></span>. 2020 <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>Tory Walker.The-Pitfalls-of-Async-Await-in-Array-Loops[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL2RhaWx5anMvdGhlLXBpdGZhbGxzLW9mLWFzeW5jLWF3YWl0LWluLWFycmF5LWxvb3BzLWNmOWNmNzEzYmZlYg==" title="https://medium.com/dailyjs/the-pitfalls-of-async-await-in-array-loops-cf9cf713bfeb">https://medium.com/dailyjs/the-pitfalls-of-async-await-in-array-loops-cf9cf713bfeb<i class="fa fa-external-link"></i></span>. 2020 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>金煜峰.小程序富文本能力的深入研究与应用[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vY29tbXVuaXR5L2RldmVsb3AvYXJ0aWNsZS9kb2MvMDAwNmUwNWMxZThkZDgwYjc4YThkNDlmMzU2NDEz" title="https://developers.weixin.qq.com/community/develop/article/doc/0006e05c1e8dd80b78a8d49f356413">https://developers.weixin.qq.com/community/develop/article/doc/0006e05c1e8dd80b78a8d49f356413<i class="fa fa-external-link"></i></span>. 2019 <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p>MakerGYT.排版规约[EB/OL].<a href="https://blog.makergyt.com/typesetting/">https://blog.makergyt.com/typesetting/</a>. 2020 <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>Tencent.微信小程序设计指南[EB/OL]<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGVzaWduLw==" title="https://developers.weixin.qq.com/miniprogram/design/">https://developers.weixin.qq.com/miniprogram/design/<i class="fa fa-external-link"></i></span>. 2019 <a href="#fnref6" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      <categories>
        <category>项目</category>
      </categories>
      <tags>
        <tag>博客</tag>
        <tag>微信小程序</tag>
        <tag>建站</tag>
      </tags>
  </entry>
</search>
